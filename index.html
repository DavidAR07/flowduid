<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker Keuangan Multi-Dompet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration (demo config - replace with your own)
const firebaseConfig = {
    apiKey: "AIzaSyASOFW-kGHoHemOJ80gax4CVKU03wDJyA8",
    authDomain: "flow-duid.firebaseapp.com",
    databaseURL: "https://flow-duid-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "flow-duid",
    storageBucket: "flow-duid.firebasestorage.app",
    messagingSenderId: "955684305421",
    appId: "1:955684305421:web:c5a9df43211e097836f344",
    measurementId: "G-LN1V1G5MLJ"
  };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.db = db;
        window.firestore = { collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query, orderBy };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8 slide-up">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ’° Tracker Keuangan Multi-Dompet</h1>
            <p class="text-gray-600">Kelola keuangan David, Fitri, dan Usaha dengan sistem hutang-piutang</p>
        </div>

        <!-- Wallet Selection -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 fade-in">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">ğŸ‘›</span> Pilih Dompet Aktif
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="switchWallet('david')" id="wallet-david" class="wallet-btn p-4 border-2 border-blue-300 rounded-lg hover:bg-blue-50 transition-all">
                    <div class="text-center">
                        <div class="text-3xl mb-2">ğŸ‘¨â€ğŸ’¼</div>
                        <h3 class="font-semibold text-gray-800">David</h3>
                        <p class="text-sm text-gray-600" id="david-balance">Rp 0</p>
                    </div>
                </button>
                <button onclick="switchWallet('fitri')" id="wallet-fitri" class="wallet-btn p-4 border-2 border-pink-300 rounded-lg hover:bg-pink-50 transition-all">
                    <div class="text-center">
                        <div class="text-3xl mb-2">ğŸ‘©â€ğŸ’¼</div>
                        <h3 class="font-semibold text-gray-800">Fitri</h3>
                        <p class="text-sm text-gray-600" id="fitri-balance">Rp 0</p>
                    </div>
                </button>
                <button onclick="switchWallet('usaha')" id="wallet-usaha" class="wallet-btn p-4 border-2 border-green-300 rounded-lg hover:bg-green-50 transition-all">
                    <div class="text-center">
                        <div class="text-3xl mb-2">ğŸ¢</div>
                        <h3 class="font-semibold text-gray-800">Usaha</h3>
                        <p class="text-sm text-gray-600" id="usaha-balance">Rp 0</p>
                    </div>
                </button>
            </div>
        </div>

        <!-- Current Wallet Info -->
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl shadow-lg p-6 mb-8 fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold" id="current-wallet-name">Pilih Dompet</h2>
                    <p class="text-purple-100">Dompet aktif saat ini</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-purple-100">Saldo</p>
                    <p class="text-3xl font-bold" id="current-wallet-balance">Rp 0</p>
                </div>
            </div>
        </div>

        <!-- Debt Summary -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500 slide-up">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ”´ Hutang Aktif</h3>
                <div id="debt-summary" class="space-y-2">
                    <p class="text-gray-500 text-sm">Tidak ada hutang</p>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 slide-up">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸŸ¢ Piutang Aktif</h3>
                <div id="credit-summary" class="space-y-2">
                    <p class="text-gray-500 text-sm">Tidak ada piutang</p>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 slide-up">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“Š Total Transaksi</h3>
                <p class="text-3xl font-bold text-blue-600" id="total-transactions">0</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form Input -->
            <div class="lg:col-span-1">
                <!-- Transaction Form -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="mr-2">â•</span> Tambah Transaksi
                    </h2>
                    
                    <form id="transactionForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Transaksi</label>
                            <select id="type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="income">ğŸ’° Pemasukan</option>
                                <option value="expense">ğŸ’¸ Pengeluaran</option>
                                <option value="debt">ğŸ”´ Hutang (Pinjam dari...)</option>
                                <option value="credit">ğŸŸ¢ Piutang (Pinjamkan ke...)</option>
                                <option value="debt-payment">ğŸ’³ Bayar Hutang</option>
                                <option value="credit-payment">ğŸ’° Terima Pembayaran</option>
                            </select>
                        </div>

                        <div id="wallet-selector" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Dari/Ke Dompet</label>
                            <select id="target-wallet" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="david">ğŸ‘¨â€ğŸ’¼ David</option>
                                <option value="fitri">ğŸ‘©â€ğŸ’¼ Fitri</option>
                                <option value="usaha">ğŸ¢ Usaha</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah (Rp)</label>
                            <input type="text" id="amount" placeholder="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>

                        <div id="category-section">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                            <select id="category" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="penjualan">ğŸ›’ Penjualan</option>
                                <option value="investasi">ğŸ“ˆ Investasi</option>
                                <option value="lainnya-masuk">ğŸ’¼ Lainnya</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                            <input type="text" id="description" placeholder="Deskripsi transaksi..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 px-6 rounded-lg font-medium hover:from-blue-700 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                            âœ¨ Tambah Transaksi
                        </button>
                    </form>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸš€ Aksi Cepat</h3>
                    <div class="space-y-3">
                        <button onclick="showDebtReport()" class="w-full bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors">
                            ğŸ“‹ Laporan Hutang-Piutang
                        </button>
                        <button onclick="exportData()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            ğŸ“Š Export Data
                        </button>
                        <button onclick="clearAllData()" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                            ğŸ—‘ï¸ Hapus Semua Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transaction List -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <span class="mr-2">ğŸ“‹</span> Riwayat Transaksi
                        </h2>
                        <div class="flex space-x-2">
                            <select id="filterType" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">Semua</option>
                                <option value="income">Pemasukan</option>
                                <option value="expense">Pengeluaran</option>
                                <option value="debt">Hutang</option>
                                <option value="credit">Piutang</option>
                            </select>
                            <select id="filterWallet" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">Semua Dompet</option>
                                <option value="david">David</option>
                                <option value="fitri">Fitri</option>
                                <option value="usaha">Usaha</option>
                            </select>
                        </div>
                    </div>

                    <div id="transactionList" class="space-y-3 max-h-96 overflow-y-auto">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-4xl mb-4 block">ğŸ“</span>
                            <p>Pilih dompet dan tambahkan transaksi pertama!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Debt Report -->
    <div id="reportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 m-4 max-w-4xl w-full max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">ğŸ“Š Laporan Hutang-Piutang</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        let transactions = [];
        let debts = []; // Track active debts
        let currentWallet = null;
        let editingId = null;
        let isFirebaseReady = false;

        // Wallet data
        const wallets = {
            david: { name: 'David', icon: 'ğŸ‘¨â€ğŸ’¼', color: 'blue' },
            fitri: { name: 'Fitri', icon: 'ğŸ‘©â€ğŸ’¼', color: 'pink' },
            usaha: { name: 'Usaha', icon: 'ğŸ¢', color: 'green' }
        };

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Format number input with thousand separators
        document.getElementById('amount').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^\d]/g, ''); // Remove non-digits
            if (value) {
                // Add thousand separators
                value = parseInt(value).toLocaleString('id-ID');
            }
            e.target.value = value;
        });

        // Transaction type change handler
        document.getElementById('type').addEventListener('change', function() {
            const type = this.value;
            const walletSelector = document.getElementById('wallet-selector');
            const categorySection = document.getElementById('category-section');
            const targetWallet = document.getElementById('target-wallet');
            
            // Show/hide wallet selector for debt/credit transactions
            if (['debt', 'credit', 'debt-payment', 'credit-payment'].includes(type)) {
                walletSelector.classList.remove('hidden');
                categorySection.classList.add('hidden');
                
                // Update target wallet options (exclude current wallet)
                updateTargetWalletOptions();
            } else {
                walletSelector.classList.add('hidden');
                categorySection.classList.remove('hidden');
                updateCategoryOptions();
            }
        });

        function updateTargetWalletOptions() {
            const targetWallet = document.getElementById('target-wallet');
            targetWallet.innerHTML = '';
            
            Object.keys(wallets).forEach(walletId => {
                if (walletId !== currentWallet) {
                    const wallet = wallets[walletId];
                    targetWallet.innerHTML += `<option value="${walletId}">${wallet.icon} ${wallet.name}</option>`;
                }
            });
        }

        function updateCategoryOptions() {
            const type = document.getElementById('type').value;
            const categorySelect = document.getElementById('category');
            
            if (type === 'income') {
                categorySelect.innerHTML = `
                    <option value="penjualan">ğŸ›’ Penjualan</option>
                    <option value="investasi">ğŸ“ˆ Investasi</option>
                    <option value="lainnya-masuk">ğŸ’¼ Lainnya</option>
                `;
            } else {
                categorySelect.innerHTML = `
                    <option value="bahan-baku">ğŸ“¦ Bahan Baku</option>
                    <option value="operasional">âš™ï¸ Operasional</option>
                    <option value="marketing">ğŸ“¢ Marketing</option>
                    <option value="sewa">ğŸ¢ Sewa</option>
                    <option value="tabungan">ğŸ’° Tabungan</option>
                    <option value="lainnya-keluar">ğŸ“‹ Lainnya</option>
                `;
            }
        }

        function switchWallet(walletId) {
            currentWallet = walletId;
            
            // Update active wallet styling
            document.querySelectorAll('.wallet-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'border-pink-500', 'border-green-500', 'bg-blue-100', 'bg-pink-100', 'bg-green-100');
                btn.classList.add(`border-${wallets[walletId].color}-300`);
            });
            
            const activeBtn = document.getElementById(`wallet-${walletId}`);
            activeBtn.classList.remove(`border-${wallets[walletId].color}-300`);
            activeBtn.classList.add(`border-${wallets[walletId].color}-500`, `bg-${wallets[walletId].color}-100`);
            
            // Update current wallet display
            document.getElementById('current-wallet-name').textContent = `${wallets[walletId].icon} ${wallets[walletId].name}`;
            
            updateWalletBalances();
            displayTransactions();
            updateTargetWalletOptions();
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateCategoryOptions();
            loadLocalData();
            // Default to David's wallet
            switchWallet('david');
        });

        function loadLocalData() {
            transactions = JSON.parse(localStorage.getItem('transactions')) || [];
            debts = JSON.parse(localStorage.getItem('debts')) || [];
            updateWalletBalances();
            updateDebtSummary();
        }

        function saveLocalData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('debts', JSON.stringify(debts));
        }

        // Form submission
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentWallet) {
                showNotification('Pilih dompet terlebih dahulu!', 'error');
                return;
            }
            
            const type = document.getElementById('type').value;
            const amountStr = document.getElementById('amount').value.replace(/[^\d]/g, '');
            const amount = parseFloat(amountStr);
            const description = document.getElementById('description').value;
            const date = document.getElementById('date').value;
            
            let category = null;
            let targetWallet = null;
            
            if (['debt', 'credit', 'debt-payment', 'credit-payment'].includes(type)) {
                targetWallet = document.getElementById('target-wallet').value;
            } else {
                category = document.getElementById('category').value;
            }

            const transaction = {
                id: Date.now(),
                wallet: currentWallet,
                type,
                amount,
                category,
                targetWallet,
                description,
                date,
                timestamp: new Date().toISOString()
            };

            // Handle debt/credit logic
            if (type === 'debt') {
                // Create debt record
                const debt = {
                    id: Date.now(),
                    from: targetWallet,
                    to: currentWallet,
                    amount: amount,
                    description: description,
                    date: date,
                    status: 'active'
                };
                debts.push(debt);
            } else if (type === 'credit') {
                // Create credit record (reverse debt)
                const debt = {
                    id: Date.now(),
                    from: currentWallet,
                    to: targetWallet,
                    amount: amount,
                    description: description,
                    date: date,
                    status: 'active'
                };
                debts.push(debt);
            } else if (type === 'debt-payment') {
                // Find and reduce/remove debt
                const debtIndex = debts.findIndex(d => 
                    d.to === currentWallet && 
                    d.from === targetWallet && 
                    d.status === 'active'
                );
                if (debtIndex !== -1) {
                    if (debts[debtIndex].amount <= amount) {
                        debts[debtIndex].status = 'paid';
                    } else {
                        debts[debtIndex].amount -= amount;
                    }
                }
            } else if (type === 'credit-payment') {
                // Find and reduce/remove credit
                const debtIndex = debts.findIndex(d => 
                    d.from === currentWallet && 
                    d.to === targetWallet && 
                    d.status === 'active'
                );
                if (debtIndex !== -1) {
                    if (debts[debtIndex].amount <= amount) {
                        debts[debtIndex].status = 'paid';
                    } else {
                        debts[debtIndex].amount -= amount;
                    }
                }
            }

            transactions.unshift(transaction);
            saveLocalData();
            
            // Reset form
            this.reset();
            document.getElementById('date').valueAsDate = new Date();
            updateCategoryOptions();
            
            updateWalletBalances();
            displayTransactions();
            updateDebtSummary();
            
            showNotification('Transaksi berhasil disimpan!', 'success');
        });

        function updateWalletBalances() {
            Object.keys(wallets).forEach(walletId => {
                let balance = 0;
                
                transactions.forEach(t => {
                    if (t.wallet === walletId) {
                        if (t.type === 'income' || t.type === 'debt' || t.type === 'credit-payment') {
                            balance += t.amount;
                        } else if (t.type === 'expense' || t.type === 'credit' || t.type === 'debt-payment') {
                            balance -= t.amount;
                        }
                    }
                });
                
                document.getElementById(`${walletId}-balance`).textContent = formatCurrency(balance);
                
                if (walletId === currentWallet) {
                    document.getElementById('current-wallet-balance').textContent = formatCurrency(balance);
                }
            });
            
            // Update total transactions
            document.getElementById('total-transactions').textContent = transactions.length;
        }

        function updateDebtSummary() {
            const activeDebts = debts.filter(d => d.status === 'active');
            
            // Current wallet's debts (what current wallet owes)
            const currentWalletDebts = activeDebts.filter(d => d.to === currentWallet);
            const debtSummary = document.getElementById('debt-summary');
            
            if (currentWalletDebts.length === 0) {
                debtSummary.innerHTML = '<p class="text-gray-500 text-sm">Tidak ada hutang</p>';
            } else {
                debtSummary.innerHTML = currentWalletDebts.map(debt => `
                    <div class="flex justify-between items-center text-sm">
                        <span>ke ${wallets[debt.from].icon} ${wallets[debt.from].name}</span>
                        <span class="font-medium text-red-600">${formatCurrency(debt.amount)}</span>
                    </div>
                `).join('');
            }
            
            // Current wallet's credits (what others owe to current wallet)
            const currentWalletCredits = activeDebts.filter(d => d.from === currentWallet);
            const creditSummary = document.getElementById('credit-summary');
            
            if (currentWalletCredits.length === 0) {
                creditSummary.innerHTML = '<p class="text-gray-500 text-sm">Tidak ada piutang</p>';
            } else {
                creditSummary.innerHTML = currentWalletCredits.map(debt => `
                    <div class="flex justify-between items-center text-sm">
                        <span>dari ${wallets[debt.to].icon} ${wallets[debt.to].name}</span>
                        <span class="font-medium text-green-600">${formatCurrency(debt.amount)}</span>
                    </div>
                `).join('');
            }
        }

        function displayTransactions() {
            if (!currentWallet) return;
            
            const filterType = document.getElementById('filterType').value;
            const filterWallet = document.getElementById('filterWallet').value;
            
            let filteredTransactions = [...transactions];

            // Filter by wallet
            if (filterWallet !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.wallet === filterWallet);
            }

            // Filter by type
            if (filterType !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.type === filterType);
            }

            const listElement = document.getElementById('transactionList');
            
            if (filteredTransactions.length === 0) {
                listElement.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <span class="text-4xl mb-4 block">ğŸ“</span>
                        <p>Tidak ada transaksi yang sesuai dengan filter</p>
                    </div>
                `;
                return;
            }

            listElement.innerHTML = filteredTransactions.map(transaction => {
                const walletInfo = wallets[transaction.wallet];
                const typeInfo = getTransactionTypeInfo(transaction);
                
                return `
                    <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors fade-in">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center ${typeInfo.bgColor}">
                                <span class="text-xl">${typeInfo.icon}</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800">${transaction.description}</h4>
                                <p class="text-sm text-gray-600">
                                    ${walletInfo.icon} ${walletInfo.name} â€¢ ${typeInfo.label} â€¢ ${formatDate(transaction.date)}
                                </p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="font-semibold ${typeInfo.textColor}">
                                ${typeInfo.sign}${formatCurrency(transaction.amount)}
                            </span>
                            <button onclick="deleteTransaction(${transaction.id})" class="text-red-600 hover:text-red-800 p-1">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTransactionTypeInfo(transaction) {
            const types = {
                'income': { icon: 'ğŸ’°', label: 'Pemasukan', sign: '+', textColor: 'text-green-600', bgColor: 'bg-green-100' },
                'expense': { icon: 'ğŸ’¸', label: 'Pengeluaran', sign: '-', textColor: 'text-red-600', bgColor: 'bg-red-100' },
                'debt': { icon: 'ğŸ”´', label: `Hutang dari ${wallets[transaction.targetWallet]?.name}`, sign: '+', textColor: 'text-blue-600', bgColor: 'bg-blue-100' },
                'credit': { icon: 'ğŸŸ¢', label: `Piutang ke ${wallets[transaction.targetWallet]?.name}`, sign: '-', textColor: 'text-orange-600', bgColor: 'bg-orange-100' },
                'debt-payment': { icon: 'ğŸ’³', label: `Bayar hutang ke ${wallets[transaction.targetWallet]?.name}`, sign: '-', textColor: 'text-red-600', bgColor: 'bg-red-100' },
                'credit-payment': { icon: 'ğŸ’°', label: `Terima dari ${wallets[transaction.targetWallet]?.name}`, sign: '+', textColor: 'text-green-600', bgColor: 'bg-green-100' }
            };
            
            return types[transaction.type] || types['income'];
        }

        function deleteTransaction(id) {
            if (confirm('Yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveLocalData();
                updateWalletBalances();
                displayTransactions();
                updateDebtSummary();
                showNotification('Transaksi berhasil dihapus!', 'success');
            }
        }

        function showDebtReport() {
            const activeDebts = debts.filter(d => d.status === 'active');
            
            let reportContent = '<div class="space-y-6">';
            
            // Summary by wallet
            Object.keys(wallets).forEach(walletId => {
                const wallet = wallets[walletId];
                const walletDebts = activeDebts.filter(d => d.to === walletId);
                const walletCredits = activeDebts.filter(d => d.from === walletId);
                
                const totalDebt = walletDebts.reduce((sum, d) => sum + d.amount, 0);
                const totalCredit = walletCredits.reduce((sum, d) => sum + d.amount, 0);
                
                reportContent += `
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold text-lg mb-3">${wallet.icon} ${wallet.name}</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-red-50 p-3 rounded">
                                <p class="text-sm text-red-800">Total Hutang</p>
                                <p class="text-xl font-bold text-red-600">${formatCurrency(totalDebt)}</p>
                            </div>
                            <div class="bg-green-50 p-3 rounded">
                                <p class="text-sm text-green-800">Total Piutang</p>
                                <p class="text-xl font-bold text-green-600">${formatCurrency(totalCredit)}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Detailed debt list
            if (activeDebts.length > 0) {
                reportContent += `
                    <div>
                        <h4 class="font-semibold text-lg mb-3">Detail Hutang-Piutang Aktif</h4>
                        <div class="space-y-2">
                            ${activeDebts.map(debt => `
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                    <span>${wallets[debt.to].icon} ${wallets[debt.to].name} berhutang ke ${wallets[debt.from].icon} ${wallets[debt.from].name}</span>
                                    <span class="font-medium">${formatCurrency(debt.amount)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            reportContent += '</div>';
            
            document.getElementById('reportContent').innerHTML = reportContent;
            document.getElementById('reportModal').classList.remove('hidden');
            document.getElementById('reportModal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('reportModal').classList.add('hidden');
            document.getElementById('reportModal').classList.remove('flex');
        }

        function exportData() {
            const data = {
                transactions: transactions,
                debts: debts,
                exportDate: new Date().toISOString()
            };
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `keuangan-multi-dompet-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showNotification('Data berhasil diexport!', 'success');
        }

        function clearAllData() {
            if (confirm('Yakin ingin menghapus SEMUA data? Tindakan ini tidak dapat dibatalkan!')) {
                transactions = [];
                debts = [];
                localStorage.removeItem('transactions');
                localStorage.removeItem('debts');
                updateWalletBalances();
                displayTransactions();
                updateDebtSummary();
                showNotification('Semua data berhasil dihapus!', 'success');
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            let bgColor = 'bg-red-500';
            if (type === 'success') bgColor = 'bg-green-500';
            if (type === 'info') bgColor = 'bg-blue-500';
            
            notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 ${bgColor} fade-in`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Filter event listeners
        document.getElementById('filterType').addEventListener('change', displayTransactions);
        document.getElementById('filterWallet').addEventListener('change', displayTransactions);

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b773624459fd96',t:'MTc1NzI2MTE1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
